# Expression Engine



# Expression Engine

Orchka uses **JSONata** as its expression language, allowing you to transform and manipulate data as it flows between nodes.

## Syntax

Expressions are written inside double curly braces:

```
{{ expression }}
```

## Accessing Data

### Input Data (`$input`)

Access data from the previous node using `$input`:

```
{{ $input.propertyName }}
```

**Examples:**

```
{{ $input.user.name }}          // Nested property
{{ $input.items[0] }}           // Array index
{{ $input.items[0].id }}        // Nested array access
{{ $input.response.data.users }} // Deep nesting
```

### Previous Nodes

Access data from any previous node by name:

```
{{ $nodes.HTTP_Request.data.result }}
{{ $nodes.AI_Agent.response }}
```

## Common Operations

### String Operations

```
{{ $uppercase($input.name) }}              // JOHN
{{ $lowercase($input.name) }}              // john
{{ $trim($input.text) }}                   // Remove whitespace
{{ $substring($input.text, 0, 10) }}       // First 10 chars
{{ $replace($input.text, "old", "new") }}  // Replace text
{{ $input.first & " " & $input.last }}     // Concatenation
```

### Numeric Operations

```
{{ $input.price * 1.1 }}                   // Multiply
{{ $sum($input.items.price) }}             // Sum array
{{ $average($input.scores) }}              // Average
{{ $round($input.value, 2) }}              // Round to 2 decimals
{{ $floor($input.num) }}                   // Floor
{{ $ceil($input.num) }}                    // Ceiling
```

### Array Operations

```
{{ $count($input.items) }}                 // Array length
{{ $filter($input.items, function($v) { $v.active = true }) }}
{{ $map($input.items, function($v) { $v.name }) }}
{{ $sort($input.items, function($a, $b) { $a.date > $b.date }) }}
{{ $append($input.arr1, $input.arr2) }}    // Merge arrays
{{ $distinct($input.tags) }}               // Unique values
```

### Conditional Logic

```
{{ $input.status = "active" ? "Yes" : "No" }}
{{ $exists($input.email) ? $input.email : "N/A" }}
{{ $input.score >= 90 ? "A" : $input.score >= 80 ? "B" : "C" }}
```

### Date & Time

```
{{ $now() }}                               // Current timestamp
{{ $toMillis($input.date) }}               // To milliseconds
{{ $fromMillis($input.timestamp) }}        // From milliseconds
```

### Object Operations

```
{{ $keys($input.user) }}                   // Get object keys
{{ $lookup($input.users, "id") }}          // Lookup by key
{{ $merge([$input.defaults, $input.custom]) }} // Merge objects
{{ $spread($input.items) }}                // Spread array to object
```

## Real-World Examples

### API Response Transformation

```json
// Input from HTTP Request
{
  "data": {
    "users": [
      { "id": 1, "name": "Alice", "email": "alice@example.com" },
      { "id": 2, "name": "Bob", "email": "bob@example.com" }
    ]
  }
}
```

**Expression to extract names:**

```
{{ $map($input.data.users, function($u) { $u.name }) }}
// Result: ["Alice", "Bob"]
```

### Building API Request Body

```json
{
  "user": "{{ $input.username }}",
  "timestamp": "{{ $now() }}",
  "items": "{{ $filter($input.products, function($p) { $p.inStock = true }) }}"
}
```

### Conditional Message

```
{{ $input.count > 0 ? "Found " & $string($input.count) & " results" : "No results found" }}
```

## Best Practices

1. **Use descriptive paths** - `$input.user.profile.name` is clearer than `$input.a.b.c`
2. **Handle missing data** - Use `$exists()` or default values
3. **Test expressions** - Use the expression preview in the settings panel
4. **Keep it simple** - Break complex transformations into multiple nodes

## Debugging

Use the **Node Detail Modal** to:

* View input data from previous nodes
* Preview expression results
* See the actual output after execution

<Cards>
  <Card title="JSONata Reference" href="https://docs.jsonata.org/">
    Full JSONata documentation.
  </Card>

  <Card title="Node Types" href="/docs/nodes">
    Configure nodes with expressions.
  </Card>
</Cards>


# Getting Started



# Getting Started

This guide will walk you through creating your first workflow in Orchka.

## Prerequisites

Before you begin, make sure you have:

* A running Orchka instance
* A web browser (Chrome, Firefox, or Safari recommended)

## Creating Your First Workflow

### Step 1: Access the Dashboard

Navigate to the Orchka dashboard. You'll see a list of your existing workflows (if any) and a button to create new ones.

### Step 2: Create a New Workflow

Click the **"New Workflow"** button. This will:

1. Generate a unique workflow with a random name
2. Redirect you to the workflow editor
3. Add a default **Manual Trigger** node to the canvas

### Step 3: Understanding the Editor

The workflow editor consists of:

| Area               | Description                                               |
| ------------------ | --------------------------------------------------------- |
| **Canvas**         | The main drag-and-drop area where you build your workflow |
| **Sidebar**        | Contains all available nodes organized by category        |
| **Toolbar**        | Execute, save, and manage your workflow                   |
| **Settings Panel** | Configure the selected node                               |

### Step 4: Add Your First Action Node

1. Open the node selector by clicking the **+** button or right-clicking on the canvas
2. Browse the available categories:
   * **Triggers** - Start points for workflows
   * **Actions** - Perform operations (HTTP requests, AI agents, etc.)
   * **Control** - Flow control (conditions, loops, waits)
3. Click on a node to add it to the canvas

### Step 5: Connect Nodes

Drag from the **output handle** (right side) of one node to the **input handle** (left side) of another to create a connection.

```
[Manual Trigger] ──→ [HTTP Request] ──→ [AI Agent]
```

### Step 6: Configure Nodes

Click on any node to open its settings panel:

* **HTTP Request**: Set the URL, method, headers, and body
* **AI Agent**: Configure the AI model and available tools
* **Condition**: Define the expression to evaluate

### Step 7: Execute Your Workflow

Click the **"Execute"** button in the toolbar. Watch as:

1. Each node executes in sequence
2. Status indicators show success/failure
3. Output data flows between nodes

## Next Steps

<Cards>
  <Card title="Node Types" href="/docs/nodes">
    Learn about all available node types.
  </Card>

  <Card title="Expressions" href="/docs/expressions">
    Master the expression engine for dynamic data.
  </Card>

  <Card title="AI Agents" href="/docs/nodes/ai-agent">
    Build intelligent workflows with AI.
  </Card>
</Cards>


# Welcome to Orchka



import { Cards, Card } from 'fumadocs-ui/components/card';
import { Steps, Step } from 'fumadocs-ui/components/steps';

# Welcome to Orchka

Orchka is a **powerful workflow automation platform** that lets you design, build, and execute complex workflows through a visual drag-and-drop interface.

## Key Features

<Cards>
  <Card title="Visual Workflow Editor" href="/docs/getting-started/editor">
    Design workflows with an intuitive drag-and-drop canvas powered by React Flow.
  </Card>

  <Card title="AI Integration" href="/docs/nodes/ai-agent">
    Connect AI agents with tools like LangChain for intelligent automation.
  </Card>

  <Card title="Expression Engine" href="/docs/expressions">
    Transform data dynamically using JSONata expressions.
  </Card>

  <Card title="Real-time Execution" href="/docs/execution">
    Watch your workflows execute in real-time with live status updates.
  </Card>
</Cards>

## Quick Start

<Steps>
  <Step>
    ### Create a Workflow

    Navigate to the dashboard and click "New Workflow" to create your first automation.
  </Step>

  <Step>
    ### Add Nodes

    Drag nodes from the sidebar onto the canvas. Connect them to define the flow of data.
  </Step>

  <Step>
    ### Configure & Execute

    Configure each node's settings, then click "Execute" to run your workflow.
  </Step>
</Steps>

## Architecture

Orchka is built on modern web technologies:

* **Next.js 15** - Full-stack React framework with App Router
* **React Flow** - Interactive node-based canvas
* **Prisma** - Type-safe database ORM
* **Inngest** - Background job processing
* **LangChain** - AI agent orchestration
* **tRPC** - End-to-end typesafe APIs

## Next Steps

<Cards>
  <Card title="Getting Started" href="/docs/getting-started">
    Learn the basics and create your first workflow.
  </Card>

  <Card title="Node Reference" href="/docs/nodes">
    Explore all available node types and their configurations.
  </Card>
</Cards>


# Node Types



# Node Types

Orchka provides a variety of node types organized into categories. Each node serves a specific purpose in your workflow.

## Triggers

Triggers are the starting points of your workflows. They define when and how a workflow begins execution.

### Manual Trigger

The default trigger that allows manual execution of workflows.

```yaml
Type: MANUAL_TRIGGER
Category: Triggers
```

**Use Cases:**

* Testing workflows during development
* On-demand automation tasks
* Debugging and troubleshooting

### Webhook Trigger

Starts a workflow when an HTTP request is received.

```yaml
Type: WEBHOOK_TRIGGER
Category: Triggers
```

**Configuration:**

* **URL**: The unique webhook endpoint
* **Method**: HTTP method to accept (GET, POST, etc.)
* **Headers**: Expected headers for validation

***

## Actions

Action nodes perform operations and can transform data.

### HTTP Request

Makes HTTP requests to external APIs and services.

```yaml
Type: HTTP_REQUEST
Category: Actions
```

**Configuration:**

| Field   | Description                   |
| ------- | ----------------------------- |
| URL     | Target endpoint               |
| Method  | GET, POST, PUT, DELETE, PATCH |
| Headers | Request headers (JSON)        |
| Body    | Request body for POST/PUT     |

**Example Configuration:**

```json
{
  "url": "https://api.example.com/data",
  "method": "POST",
  "headers": {
    "Content-Type": "application/json",
    "Authorization": "Bearer {{ $input.token }}"
  },
  "body": {
    "name": "{{ $input.name }}"
  }
}
```

### AI Agent

Executes AI-powered tasks using LangChain.

```yaml
Type: AI_AGENT
Category: Actions
```

**Configuration:**

* **Model**: AI model to use (GPT-4, Claude, Gemini, etc.)
* **System Prompt**: Instructions for the AI agent
* **Tools**: Connected AI Tool nodes for function calling

**Supported Providers:**

* OpenAI (GPT-4, GPT-3.5)
* Anthropic (Claude)
* Google (Gemini)
* Groq

### AI Tool

Defines a tool that can be used by AI Agent nodes.

```yaml
Type: AI_TOOL
Category: Actions
```

**Configuration:**

* **Name**: Tool identifier
* **Description**: What the tool does (used by AI)
* **Parameters**: JSON Schema for tool inputs
* **Implementation**: The action to perform

***

## Control

Control nodes manage the flow of execution.

### Condition (If)

Branches workflow based on an expression.

```yaml
Type: CONDITION
Category: Control
```

**Configuration:**

* **Expression**: JSONata expression that evaluates to boolean
* **True Branch**: Path when expression is true
* **False Branch**: Path when expression is false

**Example Expressions:**

```
$input.status = "success"
$input.count > 10
$exists($input.email)
```

### Wait

Pauses workflow execution for a specified duration.

```yaml
Type: WAIT
Category: Control
```

**Configuration:**

* **Duration**: Time to wait
* **Unit**: seconds, minutes, hours, days

### Loop

Iterates over an array of items.

```yaml
Type: LOOP
Category: Control
```

**Configuration:**

* **Items**: Array expression to iterate
* **Variable**: Name for current item

***

## Next Steps

<Cards>
  <Card title="Expressions" href="/docs/expressions">
    Learn to transform data between nodes.
  </Card>

  <Card title="AI Agent Deep Dive" href="/docs/nodes/ai-agent">
    Master AI-powered automation.
  </Card>
</Cards>


# Components



## Code Block

```js
console.log('Hello World');
```

## Cards

<Cards>
  <Card title="Learn more about Next.js" href="https://nextjs.org/docs" />

  <Card title="Learn more about Fumadocs" href="https://fumadocs.dev" />
</Cards>


# AI Agent



# AI Agent

The AI Agent node enables you to integrate large language models into your workflows for intelligent automation, content generation, and decision-making.

## Overview

AI Agents in Orchka are powered by **LangChain**, providing access to multiple AI providers and the ability to use tools for complex tasks.

```mermaid
graph LR
    A[Input Data] --> B[AI Agent]
    C[AI Tools] --> B
    B --> D[Response]
```

## Configuration

### Model Selection

Choose from supported AI providers:

| Provider  | Models                       | API Key Required    |
| --------- | ---------------------------- | ------------------- |
| OpenAI    | GPT-4, GPT-4 Turbo, GPT-3.5  | `OPENAI_API_KEY`    |
| Anthropic | Claude 3 Opus, Sonnet, Haiku | `ANTHROPIC_API_KEY` |
| Google    | Gemini Pro, Gemini Ultra     | `GOOGLE_API_KEY`    |
| Groq      | Mixtral, LLaMA               | `GROQ_API_KEY`      |

### System Prompt

Define the AI agent's behavior and personality:

```
You are a helpful assistant that analyzes customer feedback and extracts key insights.
Always respond in JSON format with the following structure:
{
  "sentiment": "positive" | "negative" | "neutral",
  "topics": ["array", "of", "topics"],
  "summary": "brief summary"
}
```

### Input Message

The user message sent to the AI, typically using expressions:

```
Analyze this customer review: {{ $input.reviewText }}
```

## Using AI Tools

AI Agents can use connected **AI Tool** nodes to perform actions. This enables:

* Fetching external data
* Making calculations
* Calling APIs
* Database lookups

### Connecting Tools

1. Create an **AI Tool** node on the canvas
2. Connect it to the AI Agent's **tools handle** (bottom)
3. Configure the tool's name, description, and parameters

### Tool Configuration Example

**Tool: Weather Lookup**

```yaml
Name: get_weather
Description: Get current weather for a location
Parameters:
  type: object
  properties:
    location:
      type: string
      description: City name or coordinates
  required:
    - location
```

The AI will automatically call this tool when it needs weather information.

## Response Handling

### Structured Output

To get structured JSON responses:

1. Include format instructions in the system prompt
2. Use json parsing in subsequent nodes:

```
{{ $parse($input.response) }}
```

### Streaming (Coming Soon)

Real-time streaming of AI responses for long-form content generation.

## Best Practices

### 1. Clear Instructions

Be specific in your system prompt:

```
❌ "Summarize the text"
✅ "Summarize the following text in exactly 3 bullet points, each under 20 words"
```

### 2. Handle Errors

Add a Condition node after AI Agent to handle failures:

```
{{ $exists($input.error) }}
```

### 3. Cost Optimization

* Use GPT-3.5 for simple tasks
* Reserve GPT-4 for complex reasoning
* Set appropriate `max_tokens` limits

### 4. Temperature Settings

| Temperature | Use Case                     |
| ----------- | ---------------------------- |
| 0.0 - 0.3   | Factual, deterministic tasks |
| 0.4 - 0.7   | Balanced creativity          |
| 0.8 - 1.0   | Creative, varied outputs     |

## Example Workflows

### Customer Support Triage

```
[Email Webhook] → [AI Agent] → [Condition] → [Route to Team]
                      ↑
              [Priority Classifier Tool]
```

### Content Generation Pipeline

```
[Topic Input] → [AI Agent: Research] → [AI Agent: Write] → [AI Agent: Edit] → [Output]
```

### Data Extraction

```
[File Upload] → [Parse PDF] → [AI Agent: Extract Fields] → [Save to Database]
```

## Troubleshooting

### Common Issues

**"API key not configured"**

* Ensure the correct environment variable is set
* Restart the server after adding keys

**"Rate limit exceeded"**

* Add Wait nodes between AI calls
* Implement retry logic with exponential backoff

**"Response truncated"**

* Increase `max_tokens` setting
* Break complex tasks into smaller prompts

<Cards>
  <Card title="Expressions" href="/docs/expressions">
    Pass dynamic data to AI prompts.
  </Card>

  <Card title="Node Types" href="/docs/nodes">
    Back to all node types.
  </Card>
</Cards>
